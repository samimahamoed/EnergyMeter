\hypertarget{a00005}{\section{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}
\label{dd/dad/a00005}\index{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}}
}








  


\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int8\-\_\-t \hyperlink{a00005_ga369ee0e8379941cbc2c79b90ec3292da}{config\-\_\-cmd} (uint32\-\_\-t cmd, uint8\-\_\-t arg,...)
\begin{DoxyCompactList}\small\item\em 

 \end{DoxyCompactList}\item 
int8\-\_\-t \hyperlink{a00005_gae9a5abd4e5054e7ea3f149b1764f2cd0}{ade7880\-\_\-power\-\_\-mode} (uint8\-\_\-t mode)
\begin{DoxyCompactList}\small\item\em 

 \end{DoxyCompactList}\item 
int8\-\_\-t \hyperlink{a00005_ga7782772c18e6ea515dcd28dcaedd0f06}{ade7880\-\_\-config\-\_\-reg\-\_\-default} ()
\begin{DoxyCompactList}\small\item\em 

 \end{DoxyCompactList}\end{DoxyCompactItemize}
\begin{DoxyCompactItemize}
\item 
int8\-\_\-t \hyperlink{a00005_ga96ddfd5c89b80852982ba50dd18256f6}{spi\-\_\-init} (uint8\-\_\-t chip\-\_\-select)
\begin{DoxyCompactList}\small\item\em 

 \end{DoxyCompactList}\end{DoxyCompactItemize}
\begin{DoxyCompactItemize}
\item 
int8\-\_\-t \hyperlink{a00005_ga156b48448f55534a2f9c805a1f760efa}{rpi\-\_\-gpio\-\_\-init} (void)
\begin{DoxyCompactList}\small\item\em 

 \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}






 \hypertarget{file3}{}\subsubsection{D\-E\-V\-I\-C\-E C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}\label{file3}
The module contains functions that are prepared and used to configure the \par
 Raspberry pi G\-P\-I\-O and spi interface, As well as A\-D\-E7880 Power mode, \par
 Serial Port selection (that is S\-P\-I port activation) and Default configuration \par
 procedure as described in the device datasheet section Q\-U\-I\-C\-K S\-E\-T\-U\-P A\-S E\-N\-E\-R\-G\-Y M\-E\-T\-E\-R.

\par


{\itshape A\-D\-E7880} S\-P\-I P\-O\-R\-T A\-C\-T\-I\-V\-A\-T\-I\-O\-N \par
 \begin{DoxyItemize}
\item T\-O\-G\-E\-L S\-S P\-I\-N 3 T\-I\-M\-E\-S or execute three S\-P\-I write operations to a location in the address space that is not allocated to a specific register \item Write to C\-O\-N\-F\-I\-G2 register to lock the port.\end{DoxyItemize}
{\itshape P\-O\-W\-E\-R} M\-O\-D\-E S\-E\-L\-E\-C\-T\-I\-O\-N \par
 The A\-D\-E7880 has four modes of operation, determined by the state of the P\-M0 and P\-M1 pins  
\begin{DoxyImageNoCaption}
  \mbox{\includegraphics{power_mode.PNG}}
\end{DoxyImageNoCaption}


{\itshape A\-D\-E7880} D\-E\-F\-A\-U\-L\-T C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N \par
 This is a procedure adapted from the device datasheet section Q\-U\-I\-C\-K S\-E\-T\-U\-P A\-S E\-N\-E\-R\-G\-Y M\-E\-T\-E\-R based on the application. \begin{DoxyItemize}
\item Configer gain registers \item Initialize W\-T\-H\-R, V\-A\-R\-T\-H\-R, V\-A\-T\-H\-R, V\-L\-E\-V\-E\-L and V\-N\-O\-M registers based Equation 26, Equation 37, Equation 44, Equation 22, and Equation 42, respectively, Please see the datasheet \par
 A\-D\-E7880 \href{http://www.analog.com/static/imported-files/data_sheets/ADE7880.pdf}{\tt http\-://www.\-analog.\-com/static/imported-\/files/data\-\_\-sheets/\-A\-D\-E7880.\-pdf}. \item Enable the data memory R\-A\-M protection, by writing 0x\-A\-D to an internal 8-\/bit register located \par
 at Address 0x\-E7\-F\-E, followed by a write of 0x80 to an internal 8-\/bit register located at Address 0x\-E7\-E3.\end{DoxyItemize}
\begin{DoxyItemize}
\item Start the D\-S\-P by setting Run = 1. \end{DoxyItemize}


\subsection{Function Documentation}
\hypertarget{a00005_ga7782772c18e6ea515dcd28dcaedd0f06}{\index{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}!ade7880\-\_\-config\-\_\-reg\-\_\-default@{ade7880\-\_\-config\-\_\-reg\-\_\-default}}
\index{ade7880\-\_\-config\-\_\-reg\-\_\-default@{ade7880\-\_\-config\-\_\-reg\-\_\-default}!DEVICE_CONFIGERATION@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}}
\subsubsection[{ade7880\-\_\-config\-\_\-reg\-\_\-default}]{\setlength{\rightskip}{0pt plus 5cm}int8\-\_\-t ade7880\-\_\-config\-\_\-reg\-\_\-default (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{dd/dad/a00005_ga7782772c18e6ea515dcd28dcaedd0f06}




 

configure A\-D\-E7880 as 3-\/\-Phase, 4-\/\-Wire, Wye Distribution Systems energy meter \par
 with the default values .

\subsubsection*{function return 0 or -\/1, on success or failure respectively .}

Referenced by \hyperlink{a00035_source_l00198}{main()}, and \hyperlink{a00035_source_l00302}{reading\-\_\-loop()}.



Here is the caller graph for this function\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dd/dad/a00005_ga7782772c18e6ea515dcd28dcaedd0f06_icgraph}
\end{center}
\end{figure}


\hypertarget{a00005_gae9a5abd4e5054e7ea3f149b1764f2cd0}{\index{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}!ade7880\-\_\-power\-\_\-mode@{ade7880\-\_\-power\-\_\-mode}}
\index{ade7880\-\_\-power\-\_\-mode@{ade7880\-\_\-power\-\_\-mode}!DEVICE_CONFIGERATION@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}}
\subsubsection[{ade7880\-\_\-power\-\_\-mode}]{\setlength{\rightskip}{0pt plus 5cm}int8\-\_\-t ade7880\-\_\-power\-\_\-mode (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{mode}
\end{DoxyParamCaption}
)}}\label{dd/dad/a00005_gae9a5abd4e5054e7ea3f149b1764f2cd0}




 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mode} & indicates the selected power mode\\
\hline
\end{DoxyParams}
Function to set up power mode of A\-D\-E7880.

\subsubsection*{function return 0 or -\/1, on success or failure respectively.}

Referenced by \hyperlink{a00035_source_l00198}{main()}.



Here is the caller graph for this function\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=268pt]{dd/dad/a00005_gae9a5abd4e5054e7ea3f149b1764f2cd0_icgraph}
\end{center}
\end{figure}


\hypertarget{a00005_ga369ee0e8379941cbc2c79b90ec3292da}{\index{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}!config\-\_\-cmd@{config\-\_\-cmd}}
\index{config\-\_\-cmd@{config\-\_\-cmd}!DEVICE_CONFIGERATION@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}}
\subsubsection[{config\-\_\-cmd}]{\setlength{\rightskip}{0pt plus 5cm}int8\-\_\-t config\-\_\-cmd (
\begin{DoxyParamCaption}
\item[{uint32\-\_\-t}]{cmd, }
\item[{uint8\-\_\-t}]{arg, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{dd/dad/a00005_ga369ee0e8379941cbc2c79b90ec3292da}




 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cmd} & Indicates specific configuration procedure to be execute \\
\hline
\mbox{\tt in}  & {\em arg} & Additional argument to control the execution \\
\hline
\mbox{\tt in,out}  & {\em ...} & argument list attachment that is required by the procedure to be executed\\
\hline
\end{DoxyParams}
Function runs the selected configuration procedure on A\-D\-E7880.

\begin{DoxyReturn}{Returns}
function return 0 or -\/1, on success or failure respectively. 

 
\end{DoxyReturn}


Referenced by \hyperlink{a00035_source_l00198}{main()}, and \hyperlink{a00035_source_l00122}{wait\-\_\-new\-\_\-conversion()}.



Here is the caller graph for this function\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dd/dad/a00005_ga369ee0e8379941cbc2c79b90ec3292da_icgraph}
\end{center}
\end{figure}


\hypertarget{a00005_ga156b48448f55534a2f9c805a1f760efa}{\index{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}!rpi\-\_\-gpio\-\_\-init@{rpi\-\_\-gpio\-\_\-init}}
\index{rpi\-\_\-gpio\-\_\-init@{rpi\-\_\-gpio\-\_\-init}!DEVICE_CONFIGERATION@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}}
\subsubsection[{rpi\-\_\-gpio\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}int8\-\_\-t rpi\-\_\-gpio\-\_\-init (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{dd/dad/a00005_ga156b48448f55534a2f9c805a1f760efa}




 

configure used Rpi gpio pins. Pins used by the spi, will be setup up when \par
 the module is initialized.

\begin{DoxyReturn}{Returns}
function return 0 or -\/1, on success or failure respectively. 

 
\end{DoxyReturn}


Definition at line \hyperlink{a00038_source_l00063}{63} of file \hyperlink{a00038_source}{rpi\-\_\-hwio.\-c}.



References \hyperlink{a00039_source_l00015}{P\-I\-N\-\_\-\-I\-R\-Q0}, \hyperlink{a00039_source_l00016}{P\-I\-N\-\_\-\-I\-R\-Q1}, \hyperlink{a00039_source_l00013}{P\-I\-N\-\_\-\-P\-M0}, \hyperlink{a00039_source_l00014}{P\-I\-N\-\_\-\-P\-M1}, and \hyperlink{a00039_source_l00010}{P\-I\-N\-\_\-\-S\-S}.



Referenced by \hyperlink{a00035_source_l00198}{main()}.


\begin{DoxyCode}
00063                           \{
00064     
00065         bcm2835\_gpio\_fsel(\hyperlink{a00039_ab4b553591a495409d4f7cec4b6c3e754}{PIN\_SS},  BCM2835\_GPIO\_FSEL\_OUTP);
00066         bcm2835\_gpio\_fsel(\hyperlink{a00039_aef7884a448449013ba1f8b46b8df5c05}{PIN\_PM0},  BCM2835\_GPIO\_FSEL\_OUTP);
00067         bcm2835\_gpio\_fsel(\hyperlink{a00039_a93e6f13f663a3ca8bcf6efe2022c9b78}{PIN\_PM1},  BCM2835\_GPIO\_FSEL\_OUTP);
00068         bcm2835\_gpio\_fsel(\hyperlink{a00039_a99ed780c4dd8d2e01c5ff66064306abf}{PIN\_IRQ0}, BCM2835\_GPIO\_FSEL\_INPT);
00069         bcm2835\_gpio\_fsel(\hyperlink{a00039_a14204df3192ece77fc1b651c6625bc30}{PIN\_IRQ1}, BCM2835\_GPIO\_FSEL\_INPT);
00070             
00071 \textcolor{keywordflow}{return} 0;   
00072 \}
\end{DoxyCode}


Here is the caller graph for this function\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=222pt]{dd/dad/a00005_ga156b48448f55534a2f9c805a1f760efa_icgraph}
\end{center}
\end{figure}


\hypertarget{a00005_ga96ddfd5c89b80852982ba50dd18256f6}{\index{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}!spi\-\_\-init@{spi\-\_\-init}}
\index{spi\-\_\-init@{spi\-\_\-init}!DEVICE_CONFIGERATION@{D\-E\-V\-I\-C\-E\-\_\-\-C\-O\-N\-F\-I\-G\-E\-R\-A\-T\-I\-O\-N}}
\subsubsection[{spi\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}int8\-\_\-t spi\-\_\-init (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{chip\-\_\-select}
\end{DoxyParamCaption}
)}}\label{dd/dad/a00005_ga96ddfd5c89b80852982ba50dd18256f6}




 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em chip\-\_\-select} & Indicates the selected chip for communication\\
\hline
\end{DoxyParams}
function initializ the Rpi S\-P\-I interfce.

\begin{DoxyReturn}{Returns}
function return 0 or -\/1, on success or failure respectively. 

 
\end{DoxyReturn}


Definition at line \hyperlink{a00038_source_l00038}{38} of file \hyperlink{a00038_source}{rpi\-\_\-hwio.\-c}.



Referenced by \hyperlink{a00035_source_l00198}{main()}, and \hyperlink{a00040_source_l00114}{spi\-\_\-rd\-\_\-wr()}.


\begin{DoxyCode}
00038                                     \{
00039     
00040     bcm2835\_spi\_begin();
00041     bcm2835\_spi\_setBitOrder(BCM2835\_SPI\_BIT\_ORDER\_MSBFIRST);    
00042     bcm2835\_spi\_setDataMode(BCM2835\_SPI\_MODE0);                     \textcolor{comment}{// Data are propagated on a falling
       edge }
00043                                                                 
00044     bcm2835\_spi\_setClockDivider(BCM2835\_SPI\_CLOCK\_DIVIDER\_256);     \textcolor{comment}{// 65536 = 262.144us = 3.814697260kHz }
00045     bcm2835\_spi\_chipSelect(chip\_select);                                            
00046     bcm2835\_spi\_setChipSelectPolarity(chip\_select, LOW);            \textcolor{comment}{// SS/HSA chip pin of ade7880 should be
       low for comminication      }
00047 
00048 \textcolor{keywordflow}{return} 0;   
00049 \}
\end{DoxyCode}


Here is the caller graph for this function\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=222pt]{dd/dad/a00005_ga96ddfd5c89b80852982ba50dd18256f6_icgraph}
\end{center}
\end{figure}


